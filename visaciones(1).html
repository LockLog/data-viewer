<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Visaciones</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-blue: #1a73e8;
            --dark-blue: #0d47a1;
            --light-blue: #e8f0fe;
            --accent-blue: #4285f4;
            --text-dark: #202124;
            --text-medium: #5f6368;
            --text-light: #ffffff;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: var(--text-dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));
            color: var(--text-light);
            padding: 20px 0;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border-radius: 0 0 10px 10px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 28px;
            font-weight: 500;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 32px;
        }

        .data-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 30px;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-box {
            flex-grow: 1;
            max-width: 400px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border: 1px solid #dadce0;
            border-radius: 24px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-medium);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th {
            background-color: var(--light-blue);
            color: var(--primary-blue);
            padding: 12px 15px;
            text-align: left;
            font-weight: 500;
            position: sticky;
            top: 0;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
            color: var(--text-medium);
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            flex-direction: column;
            gap: 15px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--light-blue);
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        footer {
            text-align: center;
            padding: 20px;
            color: var(--text-medium);
            font-size: 14px;
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .controls {
                flex-direction: column;
            }

            .search-box {
                max-width: 100%;
            }

            table {
                display: block;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-file-excel"></i>
                <h1>Visualizador de Visaciones</h1>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="data-container">
            <div class="controls">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Buscar..." onkeyup="filterTable()">
                </div>
            </div>

            <div id="tableContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Cargando datos...</p>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>© 2023 Visualizador de Visaciones. Todos los derechos reservados.</p>
    </footer>

    <script>
        // URL de la hoja de Google Sheets publicada
        const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQP2bILQQtuRoERe95YwPwYe746ggeoYc7T_fvFWR3FO-Y6_fOfLYN3d74gxlH77w/pubhtml?gid=20023303&single=true';
        
        // Columnas a mostrar (B-H, J, L) - A=0, B=1, ..., L=11
        const columnsToShow = [1, 2, 3, 4, 5, 6, 7, 9, 11];
        const dateColumns = []; // Índices de columnas con fechas (basado en columnsToShow)
        
        // Cargar los datos cuando la página esté lista
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });

        function loadData() {
            // Usamos la API de Google Sheets JSONP
            const script = document.createElement('script');
            script.src = `https://docs.google.com/spreadsheets/d/e/2PACX-1vQP2bILQQtuRoERe95YwPwYe746ggeoYc7T_fvFWR3FO-Y6_fOfLYN3d74gxlH77w/pub?gid=20023303&single=true&output=json&callback=processData`;
            document.body.appendChild(script);
        }

        function processData(json) {
            const tableContainer = document.getElementById('tableContainer');
            
            try {
                // Extraer filas de datos
                const rows = json.table.rows;
                
                if (rows.length < 2) {
                    tableContainer.innerHTML = '<p>No se encontraron datos en la hoja.</p>';
                    return;
                }
                
                // Obtener encabezados
                const headers = columnsToShow.map(index => {
                    return rows[0].c[index]?.v || `Columna ${String.fromCharCode(65 + index)}`;
                });
                
                // Procesar datos
                const data = [];
                for (let i = 1; i < rows.length; i++) {
                    const rowData = columnsToShow.map((colIndex, idx) => {
                        const cell = rows[i].c[colIndex];
                        if (!cell) return '';
                        
                        // Formatear fechas si es necesario
                        if (dateColumns.includes(idx) && cell.v) {
                            const date = new Date(cell.v);
                            if (!isNaN(date)) {
                                return formatDate(date);
                            }
                        }
                        
                        return cell.v !== undefined ? cell.v : '';
                    });
                    data.push(rowData);
                }
                
                renderTable(headers, data);
            } catch (error) {
                console.error('Error al procesar datos:', error);
                tableContainer.innerHTML = `
                    <p style="color: #d32f2f;">Error al cargar los datos: ${error.message}</p>
                `;
            }
        }

        function formatDate(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = String(date.getFullYear()).slice(-2);
            return `${day}-${month}-${year}`;
        }

        function renderTable(headers, data) {
            const tableContainer = document.getElementById('tableContainer');
            
            if (data.length === 0) {
                tableContainer.innerHTML = '<p>No se encontraron resultados.</p>';
                return;
            }
            
            // Crear tabla
            const table = document.createElement('table');
            
            // Crear encabezados
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
            
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // Crear cuerpo de la tabla
            const tbody = document.createElement('tbody');
            tbody.id = "tableBody";
            
            // Agregar filas de datos
            data.forEach(rowData => {
                const row = document.createElement('tr');
                
                rowData.forEach(cellData => {
                    const td = document.createElement('td');
                    td.textContent = cellData !== undefined ? cellData : '';
                    row.appendChild(td);
                });
                
                tbody.appendChild(row);
            });
            
            table.appendChild(tbody);
            tableContainer.innerHTML = '';
            tableContainer.appendChild(table);
        }

        function filterTable() {
            const input = document.getElementById('searchInput');
            const filter = input.value.toLowerCase();
            const tbody = document.getElementById('tableBody');
            
            if (!tbody) return;
            
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const cells = row.getElementsByTagName('td');
                let found = false;
                
                for (let j = 0; j < cells.length; j++) {
                    const cell = cells[j];
                    if (cell) {
                        const text = cell.textContent || cell.innerText;
                        if (text.toLowerCase().indexOf(filter) > -1) {
                            found = true;
                            break;
                        }
                    }
                }
                
                row.style.display = found ? '' : 'none';
            }
        }
    </script>
</body>
</html>